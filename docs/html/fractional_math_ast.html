

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Fractional math (AST) &mdash; ideas 0.0.7a documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Confused math" href="bytecode.html" />
    <link rel="prev" title="Fractional math (token)" href="fractional_math_tok.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> ideas
          

          
          </a>

          
            
            
              <div class="version">
                0.0.7a
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="motivation.html"> Additional motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html"> Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="function_simplest.html"> Create your own</a></li>
<li class="toctree-l1"><a class="reference internal" href="possible.html"> A deep dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="tokenize.html"> About tokens</a></li>
<li class="toctree-l1"><a class="reference internal" href="tokenize_notebook.html"> Tokenizing notebook</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="guide.html"> Guide to the examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="function.html"> Improving function as a keyword</a></li>
<li class="toctree-l1"><a class="reference internal" href="nobreak.html"> nobreak as a keyword</a></li>
<li class="toctree-l1"><a class="reference internal" href="repeat.html"> repeat as a keyword</a></li>
<li class="toctree-l1"><a class="reference internal" href="french.html"> French Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="french_repeat.html"> French repeat</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto_self.html"> Auto-self</a></li>
<li class="toctree-l1"><a class="reference internal" href="fractional_math_tok.html"> Fractional math (token)</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"> Fractional math (AST)</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#fractions-ast-py">fractions_ast.py</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="bytecode.html"> Confused math (Bytecode)</a></li>
<li class="toctree-l1"><a class="reference internal" href="constants.html"> True constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="switch.html"> Switch statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="implicit_multiplication.html"> Implicit multiplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="lambda.html"> λ encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="excluded.html"> Examples never included - first draft</a></li>
</ul>
<p class="caption"><span class="caption-text">Other modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="import_hook.html"> import_hook.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="console.html"> console.py</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ideas</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Fractional math (AST)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/fractional_math_ast.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="bytecode.html" class="btn btn-neutral float-right" title="Confused math" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fractional_math_tok.html" class="btn btn-neutral float-left" title="Fractional math (token)" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="fractional-math-ast">
<h1>Fractional math (AST)<a class="headerlink" href="#fractional-math-ast" title="Permalink to this headline">¶</a></h1>
<div class="admonition-summary admonition">
<p class="admonition-title">Summary</p>
<ul class="simple">
<li><p>Demonstrates how to use an import hook that does an AST transformation</p></li>
<li><p>Demonstrates how to add code to initialize a module or the console
with necessary imports and/or function definitions.</p></li>
</ul>
<p><a class="reference external" href="https://github.com/aroberge/ideas/blob/master/ideas/examples/fractions_ast.py">Source code</a></p>
</div>
<p>Consider the following standard Python code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">10</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">11</span><span class="p">):</span>
<span class="gp">... </span>   <span class="nb">print</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">0.0</span>
<span class="go">0.1</span>
<span class="go">0.2</span>
<span class="go">0.30000000000000004</span>
<span class="go">0.4</span>
<span class="go">0.5</span>
<span class="go">0.6000000000000001</span>
<span class="go">0.7000000000000001</span>
<span class="go">0.8</span>
<span class="go">0.9</span>
<span class="go">1.0</span>
</pre></div>
</div>
<p>This is quite surprising for beginners, not familiar with the
limitations of representing floating point numbers.</p>
<p>However, we can “fix” this using an import hook that performs
and Abstract Syntax Tree (AST) transformation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ideas.examples</span> <span class="k">import</span> <span class="n">fractions_ast</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hook</span> <span class="o">=</span> <span class="n">fractions_ast</span><span class="o">.</span><span class="n">add_hook</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ideas</span> <span class="k">import</span> <span class="n">console</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">console</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="go">Configuration values for the console:</span>
<span class="go">    source_init from ideas.examples.fractions_ast</span>
<span class="go">    transform_ast from ideas.examples.fractions_ast</span>
<span class="go">--------------------------------------------------</span>
<span class="go">Ideas Console version 0.0.4. [Python version: 3.7.3]</span>

<span class="go">AST transformations applied: you will need to explicitly</span>
<span class="go">call print() to see the result of a command.</span>

<span class="go">~&gt;&gt; x = 1 / 10</span>
<span class="go">~&gt;&gt; for i in range(11):</span>
<span class="gp">... </span>   <span class="nb">print</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">0</span>
<span class="go">1/10</span>
<span class="go">1/5</span>
<span class="go">3/10</span>
<span class="go">2/5</span>
<span class="go">1/2</span>
<span class="go">3/5</span>
<span class="go">7/10</span>
<span class="go">4/5</span>
<span class="go">9/10</span>
<span class="go">1</span>
</pre></div>
</div>
<p>We can also achieve the same result using an import hook that
does a simple source transformation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ideas.examples</span> <span class="k">import</span> <span class="n">fractions_tok</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hook</span> <span class="o">=</span> <span class="n">fractions_tok</span><span class="o">.</span><span class="n">add_hook</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ideas</span> <span class="k">import</span> <span class="n">console</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">console</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="go">Configuration values for the console:</span>
<span class="go">    source_init from ideas.examples.fractions_tok</span>
<span class="go">    transform_source from ideas.examples.fractions_tok</span>
<span class="go">--------------------------------------------------</span>
<span class="go">Ideas Console version 0.0.4. [Python version: 3.7.3]</span>

<span class="go">~&gt;&gt; x = 1 / 10</span>
<span class="go">~&gt;&gt; for i in range(11):</span>
<span class="gp">... </span>   <span class="nb">print</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">0</span>
<span class="go">1/10</span>
<span class="go">1/5</span>
<span class="go">3/10</span>
<span class="go">2/5</span>
<span class="go">1/2</span>
<span class="go">3/5</span>
<span class="go">7/10</span>
<span class="go">4/5</span>
<span class="go">9/10</span>
<span class="go">1</span>
</pre></div>
</div>
<p>One difference between the two is that, using the source transformation,
the REPL behaves as expected, printing out any unassigned result:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~&gt;&gt;</span> <span class="c1"># fractions_tok</span>
<span class="o">~&gt;&gt;</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">10</span>
<span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="o">~&gt;&gt;</span>
</pre></div>
</div>
<p>However, this is not the case using the AST-based approach:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~&gt;&gt;</span> <span class="c1"># fractions_ast</span>
<span class="o">~&gt;&gt;</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">10</span>
<span class="o">~&gt;&gt;</span>
</pre></div>
</div>
<p>In fact, even the underscore, <cite>_</cite>, most unfortunately,
does not have its usual meaning:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">~&gt;&gt;</span> <span class="c1"># fractions_ast</span>
<span class="o">~&gt;&gt;</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">10</span>
<span class="o">~&gt;&gt;</span> <span class="nb">print</span><span class="p">(</span><span class="n">_</span><span class="p">)</span>
<span class="o">&lt;</span><span class="n">ideas</span><span class="o">.</span><span class="n">import_hook</span><span class="o">.</span><span class="n">IdeasMetaFinder</span> <span class="nb">object</span> <span class="n">at</span> <span class="mh">0x02E42030</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The reason for this is that normally, the code in the console is
evaluated using the <code class="docutils literal notranslate"><span class="pre">&quot;single&quot;</span></code> mode of the <code class="docutils literal notranslate"><span class="pre">compile</span></code> function;
however, after doing an AST transform, the code must be compiled
using the <code class="docutils literal notranslate"><span class="pre">exec</span></code> mode.</p>
<span class="target" id="module-ideas.examples.fractions_ast"></span><div class="section" id="fractions-ast-py">
<h2>fractions_ast.py<a class="headerlink" href="#fractions-ast-py" title="Permalink to this headline">¶</a></h2>
<p>Converts integers literals into instances of the Fraction class at the
Abstract Syntax Tree level.
This works for doing using Python exclusively to do integer arithmetics but it
fails miserably in other contexts that expect <code class="docutils literal notranslate"><span class="pre">int</span></code>.</p>
<p>It is only meant as a demo of AST transformations.</p>
<dl class="class">
<dt id="ideas.examples.fractions_ast.FractionWrapper">
<em class="property">class </em><code class="sig-prename descclassname">ideas.examples.fractions_ast.</code><code class="sig-name descname">FractionWrapper</code><a class="reference internal" href="_modules/ideas/examples/fractions_ast.html#FractionWrapper"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ideas.examples.fractions_ast.FractionWrapper" title="Permalink to this definition">¶</a></dt>
<dd><p>Wraps all integers in a call to Integer()</p>
</dd></dl>

<dl class="function">
<dt id="ideas.examples.fractions_ast.add_hook">
<code class="sig-prename descclassname">ideas.examples.fractions_ast.</code><code class="sig-name descname">add_hook</code><span class="sig-paren">(</span><em class="sig-param">verbose_finder=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ideas/examples/fractions_ast.html#add_hook"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ideas.examples.fractions_ast.add_hook" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates and automatically adds the import hook in sys.meta_path</p>
</dd></dl>

<dl class="function">
<dt id="ideas.examples.fractions_ast.source_init">
<code class="sig-prename descclassname">ideas.examples.fractions_ast.</code><code class="sig-name descname">source_init</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/ideas/examples/fractions_ast.html#source_init"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ideas.examples.fractions_ast.source_init" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds required imports and function redefinitions</p>
</dd></dl>

<dl class="function">
<dt id="ideas.examples.fractions_ast.transform_ast">
<code class="sig-prename descclassname">ideas.examples.fractions_ast.</code><code class="sig-name descname">transform_ast</code><span class="sig-paren">(</span><em class="sig-param">tree</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ideas/examples/fractions_ast.html#transform_ast"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ideas.examples.fractions_ast.transform_ast" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms the Abstract Syntax Tree</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bytecode.html" class="btn btn-neutral float-right" title="Confused math" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="fractional_math_tok.html" class="btn btn-neutral float-left" title="Fractional math (token)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, André Roberge

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>