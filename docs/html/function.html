

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Improving function as a keyword &mdash; ideas 0.0.7a documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="nobreak as a keyword" href="nobreak.html" />
    <link rel="prev" title="Guide to the examples" href="guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> ideas
          

          
          </a>

          
            
            
              <div class="version">
                0.0.7a
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="motivation.html"> Additional motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html"> Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="function_simplest.html"> Create your own</a></li>
<li class="toctree-l1"><a class="reference internal" href="possible.html"> A deep dive</a></li>
<li class="toctree-l1"><a class="reference internal" href="tokenize.html"> About tokens</a></li>
<li class="toctree-l1"><a class="reference internal" href="tokenize_notebook.html"> Tokenizing notebook</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="guide.html"> Guide to the examples</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"> Improving function as a keyword</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#building-a-complete-example">Building a complete example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#verbose-finder">Verbose finder</a></li>
<li class="toctree-l3"><a class="reference internal" href="#comparing-the-original-and-the-transformed-source">Comparing the original and the transformed source</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#function-keyword-py">function_keyword.py</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="nobreak.html"> nobreak as a keyword</a></li>
<li class="toctree-l1"><a class="reference internal" href="repeat.html"> repeat as a keyword</a></li>
<li class="toctree-l1"><a class="reference internal" href="french.html"> French Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="french_repeat.html"> French repeat</a></li>
<li class="toctree-l1"><a class="reference internal" href="auto_self.html"> Auto-self</a></li>
<li class="toctree-l1"><a class="reference internal" href="fractional_math_tok.html"> Fractional math (token)</a></li>
<li class="toctree-l1"><a class="reference internal" href="fractional_math_ast.html"> Fractional math (AST)</a></li>
<li class="toctree-l1"><a class="reference internal" href="bytecode.html"> Confused math (Bytecode)</a></li>
<li class="toctree-l1"><a class="reference internal" href="constants.html"> True constants</a></li>
<li class="toctree-l1"><a class="reference internal" href="switch.html"> Switch statement</a></li>
<li class="toctree-l1"><a class="reference internal" href="implicit_multiplication.html"> Implicit multiplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="lambda.html"> λ encoding</a></li>
<li class="toctree-l1"><a class="reference internal" href="excluded.html"> Examples never included - first draft</a></li>
</ul>
<p class="caption"><span class="caption-text">Other modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="import_hook.html"> import_hook.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="console.html"> console.py</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ideas</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Improving function as a keyword</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/function.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="nobreak.html" class="btn btn-neutral float-right" title="nobreak as a keyword" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="guide.html" class="btn btn-neutral float-left" title="Guide to the examples" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="improving-function-as-a-keyword">
<h1>Improving function as a keyword<a class="headerlink" href="#improving-function-as-a-keyword" title="Permalink to this headline">¶</a></h1>
<div class="admonition-summary admonition">
<p class="admonition-title">Summary</p>
<p>This builds upon our previous example of allowing
<code class="docutils literal notranslate"><span class="pre">function</span></code> to being equivalent to <code class="docutils literal notranslate"><span class="pre">lambda</span></code>.</p>
<p>This example demonstrates the use of passing back parameters
to an import hook and some possible usage.</p>
<p><a class="reference external" href="https://github.com/aroberge/ideas/blob/master/ideas/examples/function_keyword.py">Source code</a></p>
</div>
<p>Basic usage:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ideas.examples</span> <span class="k">import</span> <span class="n">function_keyword</span>
<span class="n">function_keyword</span><span class="o">.</span><span class="n">add_hook</span><span class="p">()</span>

<span class="kn">import</span> <span class="nn">my_program</span>
</pre></div>
</div>
<div class="section" id="building-a-complete-example">
<h2>Building a complete example<a class="headerlink" href="#building-a-complete-example" title="Permalink to this headline">¶</a></h2>
<p>In addition to making it easy to create import hooks, <strong>ideas</strong> also
attempts to make it easy to include diagnostic “tools”.
The <code class="docutils literal notranslate"><span class="pre">function_keyword</span></code> example, whose API listed below includes
links to the actual source, includes such “tools”.
While they can help during development, they do admitedly make
the code more complicated.  If you want to create your own hook,
you do not have to include all possible features.</p>
<p>For example, here is a much simpler version, functionally
equivalent the <code class="docutils literal notranslate"><span class="pre">function_keyword</span></code> example,
but without some diagnostic options included:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ideas</span> <span class="k">import</span> <span class="n">import_hook</span><span class="p">,</span> <span class="n">token_utils</span>

<span class="k">def</span> <span class="nf">transform_source</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">new_tokens</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">token_utils</span><span class="o">.</span><span class="n">tokenize</span><span class="p">(</span><span class="n">source</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">token</span> <span class="o">==</span> <span class="s2">&quot;function&quot;</span><span class="p">:</span>
            <span class="n">token</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;lambda&quot;</span>
        <span class="n">new_tokens</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">token_utils</span><span class="o">.</span><span class="n">untokenize</span><span class="p">(</span><span class="n">new_tokens</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">add_hook</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">import_hook</span><span class="o">.</span><span class="n">create_hook</span><span class="p">(</span><span class="n">transform_source</span><span class="o">=</span><span class="n">transform_source</span><span class="p">)</span>
</pre></div>
</div>
<p>Note the unused <code class="docutils literal notranslate"><span class="pre">**kwargs</span></code> in the definition of <code class="docutils literal notranslate"><span class="pre">transform_source</span></code>:
you should ensure to add something similar when creating your own import hook
even if you do not plan to make use of extra parameters.</p>
<div class="section" id="verbose-finder">
<h3>Verbose finder<a class="headerlink" href="#verbose-finder" title="Permalink to this headline">¶</a></h3>
<p>Suppose you want to see information about names and paths of
files that are searched by your Finder: you can do this by adding
an extra parameter to <code class="docutils literal notranslate"><span class="pre">add_hook</span></code> and
<code class="docutils literal notranslate"><span class="pre">import_hook.create_hook</span></code> as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_hook</span><span class="p">(</span><span class="n">verbose_finder</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">import_hook</span><span class="o">.</span><span class="n">create_hook</span><span class="p">(</span>
        <span class="n">transform_source</span><span class="o">=</span><span class="n">transform_source</span><span class="p">,</span>
        <span class="n">verbose_finder</span><span class="o">=</span><span class="n">verbose_finder</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Here’s a sample session from a different example, where the import hook
is looking for files with a custom extension:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ideas.examples</span> <span class="k">import</span> <span class="n">french</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hook</span> <span class="o">=</span> <span class="n">french</span><span class="o">.</span><span class="n">add_hook</span><span class="p">(</span><span class="n">verbose_finder</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="go">Looking for files with extensions:  [&#39;.pyfr&#39;]</span>
<span class="go">The following paths will not be included in the search:</span>
<span class="go">   PYTHON: == c:\users\andre\appdata\local\programs\python\python37-32\lib</span>
<span class="go">   IDEAS: == c:\users\andre\github\ideas\ideas</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">mon_programme</span>
<span class="go">    Searching for TESTS:\french\mon_programme.pyfr.</span>
<span class="go">-&gt;  Found:  TESTS:\french\mon_programme.pyfr</span>

<span class="go">    Searching for TESTS:\french\unicodedata.pyfr.</span>
<span class="go">  IdeasMetaFinder did not find unicodedata.</span>
</pre></div>
</div>
<p>The last file that was needed was <code class="docutils literal notranslate"><span class="pre">unicodedata.py</span></code> from the Python
standard library; it was found by a “normal” finder used by Python.</p>
</div>
<div class="section" id="comparing-the-original-and-the-transformed-source">
<h3>Comparing the original and the transformed source<a class="headerlink" href="#comparing-the-original-and-the-transformed-source" title="Permalink to this headline">¶</a></h3>
<div class="sidebar">
<p class="sidebar-title">pattern != actual code</p>
<p>The code used is slightly different than was is shown here.</p>
</div>
<p>It might be sometimes useful to compare the original source with
the transformed one. Instead of actually adding <code class="docutils literal notranslate"><span class="pre">print</span></code> statements
when needed, we can use some callback parameters to enable or disable
such <code class="docutils literal notranslate"><span class="pre">print</span></code> statemeent.  <strong>ideas</strong> makes it fairly easy to
do this using callback parameters.
Here’s the basic <strong>pattern</strong> used in almost all the examples:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">transform_source</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">callback_params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">callback_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">callback_params</span><span class="p">[</span><span class="s2">&quot;show_original&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

    <span class="n">new_source</span> <span class="o">=</span> <span class="n">do_transform</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">callback_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">callback_params</span><span class="p">[</span><span class="s2">&quot;show_transformed&quot;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">new_source</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_source</span>


<span class="k">def</span> <span class="nf">add_hook</span><span class="p">(</span><span class="n">show_original</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">show_transformed</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">callback_params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;show_original&quot;</span><span class="p">:</span> <span class="n">show_original</span><span class="p">,</span>
        <span class="s2">&quot;show_transformed&quot;</span><span class="p">:</span> <span class="n">show_transformed</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">hook</span> <span class="o">=</span> <span class="n">import_hook</span><span class="o">.</span><span class="n">create_hook</span><span class="p">(</span>
        <span class="n">transform_source</span><span class="o">=</span><span class="n">transform_source</span><span class="p">,</span>
        <span class="n">callback_params</span><span class="o">=</span><span class="n">callback_params</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">hook</span>
</pre></div>
</div>
<p>Here’s an actual example using one such parameter to show the transformed
source:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ideas.examples</span> <span class="k">import</span> <span class="n">function_keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">hook</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">add_hook</span><span class="p">(</span><span class="n">show_transformed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">ideas</span> <span class="k">import</span> <span class="n">console</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">console</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="go">Configuration values for the console:</span>
<span class="go">    callback_params: {&#39;show_original&#39;: False, &#39;show_transformed&#39;: True}</span>
<span class="go">    transform_source from ideas.examples.function</span>
<span class="go">--------------------------------------------------</span>
<span class="go">Ideas Console version 0.0.4. [Python version: 3.7.3]</span>

<span class="go">~&gt;&gt; square = function x: x**2</span>
<span class="go">===========Transformed============</span>
<span class="go">square = lambda x: x**2</span>
<span class="go">-----------------------------</span>
<span class="go">~&gt;&gt; square(3)</span>
<span class="go">===========Transformed============</span>
<span class="go">square(3)</span>
<span class="go">-----------------------------</span>
<span class="go">9</span>
<span class="go">~&gt;&gt;</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You do not need to make use of these extra features when
creating your own hooks.</p>
</div>
<p>If you want to have a look at the actual source for <code class="docutils literal notranslate"><span class="pre">function_keyword</span></code>,
use the links below.</p>
<div class="sidebar">
<p class="sidebar-title">API</p>
<p>Generated by Sphinx</p>
</div>
<span class="target" id="module-ideas.examples.function_keyword"></span><div class="section" id="function-keyword-py">
<h4>function_keyword.py<a class="headerlink" href="#function-keyword-py" title="Permalink to this headline">¶</a></h4>
<dl>
<dt>This module enables someone to use <code class="docutils literal notranslate"><span class="pre">function</span></code> as a keyword</dt><dd><p>equivalent to <code class="docutils literal notranslate"><span class="pre">lambda</span></code>.</p>
<p>It is slightly more complicated than <code class="docutils literal notranslate"><span class="pre">function_simplest.py</span></code> as it
demonstrates how we can pass parameters when adding an import hook;
these parameters will be passed back to our function
<code class="docutils literal notranslate"><span class="pre">transform_source</span></code>.</p>
</dd>
</dl>
<dl class="function">
<dt id="ideas.examples.function_keyword.add_hook">
<code class="sig-prename descclassname">ideas.examples.function_keyword.</code><code class="sig-name descname">add_hook</code><span class="sig-paren">(</span><em class="sig-param">show_original=False</em>, <em class="sig-param">show_transformed=False</em>, <em class="sig-param">verbose_finder=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ideas/examples/function_keyword.html#add_hook"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ideas.examples.function_keyword.add_hook" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates and automatically adds the import hook in sys.meta_path</p>
</dd></dl>

<dl class="function">
<dt id="ideas.examples.function_keyword.function_as_a_keyword">
<code class="sig-prename descclassname">ideas.examples.function_keyword.</code><code class="sig-name descname">function_as_a_keyword</code><span class="sig-paren">(</span><em class="sig-param">source</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ideas/examples/function_keyword.html#function_as_a_keyword"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ideas.examples.function_keyword.function_as_a_keyword" title="Permalink to this definition">¶</a></dt>
<dd><p>A simple replacement of <code class="docutils literal notranslate"><span class="pre">function</span></code> by <code class="docutils literal notranslate"><span class="pre">lambda</span></code>.</p>
<p>Note that, while the string <code class="docutils literal notranslate"><span class="pre">lambda</span></code> is shorter than <code class="docutils literal notranslate"><span class="pre">function</span></code>, we
do not adjust the information (start_col, end_col) about the position
of the token. <code class="docutils literal notranslate"><span class="pre">untokenize</span></code> uses that information together with the
information about each original line, to properly keep track of the
spacing between tokens.</p>
</dd></dl>

<dl class="function">
<dt id="ideas.examples.function_keyword.transform_source">
<code class="sig-prename descclassname">ideas.examples.function_keyword.</code><code class="sig-name descname">transform_source</code><span class="sig-paren">(</span><em class="sig-param">source</em>, <em class="sig-param">callback_params=None</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ideas/examples/function_keyword.html#transform_source"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ideas.examples.function_keyword.transform_source" title="Permalink to this definition">¶</a></dt>
<dd><p>This function is called by the import hook loader with the named keyword
that we specified when we created the import hook.</p>
<p>It gives us the option to compare the original source and the transformed
one. This type of additional option can be useful when debugging
a source transformer. Furthermore, if we wish to define a source
transformation that combines the effect of multiple existing
transformations, we can combine the existing “inner” functions to
create our new transformation.</p>
</dd></dl>

</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="nobreak.html" class="btn btn-neutral float-right" title="nobreak as a keyword" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="guide.html" class="btn btn-neutral float-left" title="Guide to the examples" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, André Roberge

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>