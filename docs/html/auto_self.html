

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Auto self &mdash; ideas 0.0.3 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="λ encoding" href="lambda.html" />
    <link rel="prev" title="French Python" href="french.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> ideas
          

          
          </a>

          
            
            
              <div class="version">
                0.0.3
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="motivation.html"> Additional motivation -first draft</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html"> Usage - first draft</a></li>
<li class="toctree-l1"><a class="reference internal" href="as_main.html"> Importing a module as main - todo</a></li>
<li class="toctree-l1"><a class="reference internal" href="possible.html"> Overview of all possibilities - todo</a></li>
<li class="toctree-l1"><a class="reference internal" href="excluded.html"> Examples never included - first draft</a></li>
</ul>
<p class="caption"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="function_simplest.html"> function as a keyword - part 1</a></li>
<li class="toctree-l1"><a class="reference internal" href="function.html"> function as a keyword - part 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="nobreak.html"> nobreak as a keyword - todo</a></li>
<li class="toctree-l1"><a class="reference internal" href="french.html"> French Python - todo</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"> Auto-self</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#module-ideas.examples.auto_self">Try it out!</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="lambda.html"> λ encoding - todo</a></li>
<li class="toctree-l1"><a class="reference internal" href="repeat.html"> repeat as a keyword - working code only</a></li>
<li class="toctree-l1"><a class="reference internal" href="ast.html"> Simple AST transformation - todo</a></li>
<li class="toctree-l1"><a class="reference internal" href="bytecode.html"> Simple bytecode transformation - todo</a></li>
<li class="toctree-l1"><a class="reference internal" href="switch.html"> Pythonic switch statement - todo</a></li>
<li class="toctree-l1"><a class="reference internal" href="constants.html"> True constants - working code only</a></li>
<li class="toctree-l1"><a class="reference internal" href="json.html"> Json module - todo</a></li>
<li class="toctree-l1"><a class="reference internal" href="pep_505.html"> PEP 505: None-aware operators - todo</a></li>
<li class="toctree-l1"><a class="reference internal" href="non_files.html"> Import from non-standard locations - todo</a></li>
</ul>
<p class="caption"><span class="caption-text">API</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="import_hook.html"> import_hook.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="token_utils.html"> token_utils.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html"> utils.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="console.html"> console.py</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ideas</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Auto self</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/auto_self.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="lambda.html" class="btn btn-neutral float-right" title="λ encoding" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="french.html" class="btn btn-neutral float-left" title="French Python" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="auto-self">
<h1>Auto self<a class="headerlink" href="#auto-self" title="Permalink to this headline">¶</a></h1>
<p>Python is known for its concise and readable syntax. One exception
about the concisiveness is the boiler plate code that has to be
written when defining one’s own class, especially if it has
many attributes, like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="bp">self</span><span class="o">.</span><span class="n">this_variable</span> <span class="o">=</span> <span class="n">this_variable</span>
<span class="bp">self</span><span class="o">.</span><span class="n">that_variable</span> <span class="o">=</span> <span class="n">that_variable</span>
<span class="bp">self</span><span class="o">.</span><span class="n">this_other_variable</span> <span class="o">=</span> <span class="n">this_other_variable</span>
<span class="bp">self</span><span class="o">.</span><span class="n">foo</span> <span class="o">=</span> <span class="n">foo</span>
<span class="bp">self</span><span class="o">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">bar</span>

<span class="bp">self</span><span class="o">.</span><span class="n">baz</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">baz</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">baz</span>
<span class="bp">self</span><span class="o">.</span><span class="n">spam</span> <span class="o">=</span> <span class="n">bread</span> <span class="o">+</span> <span class="n">ham</span>
</pre></div>
</div>
<p>This leads people to ask on various forums, such as
on <a class="reference external" href="https://stackoverflow.com/questions/3652851/what-is-the-best-way-to-do-automatic-attribute-assignment-in-python-and-is-it-a">StackOverflow</a>,
how to do automatic assignment of attributes.  The answers most often given
are:</p>
<blockquote>
<div><ul class="simple">
<li><p>Don’t do it</p></li>
<li><p>Use a decorator, with various examples provided</p></li>
</ul>
</div></blockquote>
<p>As programmers create more classes, they find the need to add their own
dunder methods, such as <code class="docutils literal notranslate"><span class="pre">__eq__(self,</span> <span class="pre">other)</span></code>, <code class="docutils literal notranslate"><span class="pre">__repr__(self)</span></code>, etc.
Eventually, they might get annoyed enough at having to re-create these methods
too often, with the occasionnal typo causing bugs that they jump with
joy when discovering <a class="reference external" href="https://www.attrs.org/en/stable/">attrs: Classes Without Boilerplate</a>.</p>
<p>Starting with Python 3.7, the standard library includes
<a class="reference external" href="https://docs.python.org/3/library/dataclasses.html">dataclasses</a> which shares some
similarity with <code class="docutils literal notranslate"><span class="pre">attrs</span></code>. However, it does require to use type hints which,
in my opinion, reduces readability.</p>
<p>As a concrete example of using traditional Python notation and
dataclasses, let’s consider the code given in <a class="reference external" href="https://www.python.org/dev/peps/pep-0557/">PEP 557</a> but reformatted with Black:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Application</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">requirements</span><span class="p">,</span>
        <span class="n">constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">executable_links</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">executables_dir</span><span class="o">=</span><span class="p">(),</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requirements</span> <span class="o">=</span> <span class="n">requirements</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">constraints</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executable_links</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">executable_links</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">executable_links</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">executables_dir</span> <span class="o">=</span> <span class="n">executables_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">additional_items</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>Here’s a code which gives the same initialization using the <code class="docutils literal notranslate"><span class="pre">&#64;dataclass</span></code>
decorator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="k">import</span> <span class="n">dataclass</span>

<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Application</span><span class="p">:</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">requirements</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Requirement</span><span class="p">]</span>
    <span class="n">constraints</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">dict</span><span class="p">)</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">executable_links</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
    <span class="n">executable_dir</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">additional_items</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</pre></div>
</div>
<p>This code does more than simply initializing the variables, but I
do not find it particulary readable.</p>
<p>So, I was wondering if it might be possible to imagine a simpler syntax.
<code class="docutils literal notranslate"><span class="pre">auto_self</span></code> is what I came up with.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The ship has sailed …</p>
<p>I realize that there is zero chance that the following syntax would
be adopted, now that the <code class="docutils literal notranslate"><span class="pre">dataclasses</span></code> module has been added to
the Python standard library. Still, you can try it out using
<code class="docutils literal notranslate"><span class="pre">auto_self</span></code> hook.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Application</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">requirements</span><span class="p">,</span>
        <span class="n">constraints</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">executable_links</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">executables_dir</span><span class="o">=</span><span class="p">(),</span>
    <span class="p">):</span>
        <span class="bp">self</span> <span class="o">.=</span> <span class="p">:</span>
            <span class="n">name</span>
            <span class="n">requirements</span>
            <span class="n">constraints</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">__</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">__</span>
            <span class="n">path</span>
            <span class="n">executable_links</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">__</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="n">__</span>
            <span class="n">executables_dir</span>
            <span class="n">additional_items</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>Here, I am using a new operator, <code class="docutils literal notranslate"><span class="pre">.=</span></code>, which is meant to represent
the automatic assignment of a variable to the name that precedes
it (<code class="docutils literal notranslate"><span class="pre">self</span></code> in this example).  I have seen this idea for such an operator before on
<strong>python-ideas</strong> but never as introducing a code-block as I do here.</p>
<p>By design, any dunder, <code class="docutils literal notranslate"><span class="pre">__</span></code>, is taken to be equivalent to the variable
being initialized.  I chose a dunder instead of a single underscore <code class="docutils literal notranslate"><span class="pre">_</span></code>
so that it could be used in a REPL.</p>
<p>Of course, one is not restricted to using <code class="docutils literal notranslate"><span class="pre">self</span></code>, or using <code class="docutils literal notranslate"><span class="pre">__</span></code>
everywhere. The following is completely equivalent - although slightly less
readable in my opinion, with fewer <code class="docutils literal notranslate"><span class="pre">__</span></code> used:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Application</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">requirements</span><span class="p">,</span>
        <span class="n">constraints</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">executable_links</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">executables_dir</span><span class="o">=</span><span class="p">(),</span>
    <span class="p">):</span>
        <span class="bp">cls</span> <span class="o">.=</span> <span class="p">:</span>
            <span class="n">name</span>
            <span class="n">requirements</span>
            <span class="n">constraints</span> <span class="o">=</span> <span class="p">{}</span> <span class="k">if</span> <span class="n">constraints</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">constraints</span>
            <span class="n">path</span>
            <span class="n">executable_links</span> <span class="o">=</span> <span class="p">[]</span> <span class="k">if</span> <span class="n">__</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">executable_links</span>
            <span class="n">executables_dir</span>

        <span class="bp">cls</span><span class="o">.</span><span class="n">additional_items</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<p>Note that, unlike <code class="docutils literal notranslate"><span class="pre">&#64;dataclass</span></code> or <code class="docutils literal notranslate"><span class="pre">attrs</span></code>, no additional method is
created by <code class="docutils literal notranslate"><span class="pre">auto_self</span></code>.</p>
<div class="section" id="module-ideas.examples.auto_self">
<span id="try-it-out"></span><h2>Try it out!<a class="headerlink" href="#module-ideas.examples.auto_self" title="Permalink to this headline">¶</a></h2>
<p>Description here</p>
<dl class="function">
<dt id="ideas.examples.auto_self.add_hook">
<code class="sig-prename descclassname">ideas.examples.auto_self.</code><code class="sig-name descname">add_hook</code><span class="sig-paren">(</span><em class="sig-param">show_original=False</em>, <em class="sig-param">show_transformed=False</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ideas/examples/auto_self.html#add_hook"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ideas.examples.auto_self.add_hook" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates and adds the import hook in sys.meta_path</p>
</dd></dl>

<dl class="function">
<dt id="ideas.examples.auto_self.automatic_self">
<code class="sig-prename descclassname">ideas.examples.auto_self.</code><code class="sig-name descname">automatic_self</code><span class="sig-paren">(</span><em class="sig-param">source</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ideas/examples/auto_self.html#automatic_self"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ideas.examples.auto_self.automatic_self" title="Permalink to this definition">¶</a></dt>
<dd><p>Description here.</p>
</dd></dl>

<dl class="function">
<dt id="ideas.examples.auto_self.print_info">
<code class="sig-prename descclassname">ideas.examples.auto_self.</code><code class="sig-name descname">print_info</code><span class="sig-paren">(</span><em class="sig-param">kind</em>, <em class="sig-param">source</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ideas/examples/auto_self.html#print_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ideas.examples.auto_self.print_info" title="Permalink to this definition">¶</a></dt>
<dd><p>prints information about the source - either original or transformed</p>
</dd></dl>

<dl class="function">
<dt id="ideas.examples.auto_self.transform_source">
<code class="sig-prename descclassname">ideas.examples.auto_self.</code><code class="sig-name descname">transform_source</code><span class="sig-paren">(</span><em class="sig-param">source</em>, <em class="sig-param">show_original=False</em>, <em class="sig-param">show_transformed=False</em>, <em class="sig-param">**kwargs</em><span class="sig-paren">)</span><a class="reference internal" href="_modules/ideas/examples/auto_self.html#transform_source"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ideas.examples.auto_self.transform_source" title="Permalink to this definition">¶</a></dt>
<dd><p>This function is called by the import hook loader with the named keyword
that we specified when we created the import hook.</p>
<p>It gives us the option to compare the original source and the transformed
one. This type of additional option can be useful when debugging
a source transformer. Furthermore, if we wish to define a source
transformation that combines the effect of multiple existing
transformations, we can combine the existing “inner” functions to
create our new transformation.</p>
</dd></dl>

</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lambda.html" class="btn btn-neutral float-right" title="λ encoding" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="french.html" class="btn btn-neutral float-left" title="French Python" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, André Roberge

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>